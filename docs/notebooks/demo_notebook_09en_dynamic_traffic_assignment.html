<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Huge-scale simulation using Chicago-Sketch dataset" href="demo_notebook_08en_chicago.html" /><link rel="prev" title="Taxi / Shared mobility" href="demo_notebook_06en_taxi_or_shared_mobility.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2025.07.19 -->
        <title>Dynamic Traffic Assignments: DUO, DUE, DSO - UXsim: Traffic Simulation in Python v1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=25af2a20" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-111714220-1"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-111714220-1');
</script>
  
</head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">UXsim: Traffic Simulation in Python v1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <span class="sidebar-brand-text">UXsim: Traffic Simulation in Python v1 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting started</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../tutorial.html">Tutorial and Examples</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Tutorial and Examples</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="demo_notebook_01en.html">Step-by-step Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="demo_notebook_10en_traffic_signal_tutorial.html">Tutorial on Traffic Signal</a></li>
<li class="toctree-l2"><a class="reference internal" href="demo_notebook_02en.html">Advanced example</a></li>
<li class="toctree-l2"><a class="reference internal" href="demo_notebook_03en_pytorch.html">Signal control by PyTorch (DQN)</a></li>
<li class="toctree-l2"><a class="reference internal" href="demo_notebook_04en_OpenStreetMap.html">Network data import from OpenStreetMap</a></li>
<li class="toctree-l2"><a class="reference internal" href="demo_notebook_06en_taxi_or_shared_mobility.html">Taxi / Shared mobility</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Dynamic Traffic Assignments: DUO, DUE, DSO</a></li>
<li class="toctree-l2"><a class="reference internal" href="demo_notebook_08en_chicago.html">Huge-scale simulation using Chicago-Sketch dataset</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../mechanism.html">Simulation Mechanism</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tech_ref.html">Technical Reference</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Technical Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/uxsim.World.html">uxsim.World</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/uxsim.Node.html">uxsim.Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/uxsim.Link.html">uxsim.Link</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/uxsim.Vehicle.html">uxsim.Vehicle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/uxsim.RouteChoice.html">uxsim.RouteChoice</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/uxsim.analyzer.Analyzer.html">uxsim.analyzer.Analyzer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/uxsim.Route.html">uxsim.Route</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/uxsim.DTAsolvers.SolverDUE.html">uxsim.DTAsolvers.SolverDUE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/uxsim.DTAsolvers.SolverDSO_D2D.html">uxsim.DTAsolvers.SolverDSO_D2D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/uxsim.TaxiHandler.TripRequest.html">uxsim.TaxiHandler.TripRequest</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/uxsim.TaxiHandler.TaxiHandler.html">uxsim.TaxiHandler.TaxiHandler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/uxsim.TaxiHandler.TaxiHandler_nearest.html">uxsim.TaxiHandler.TaxiHandler_nearest</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/uxsim.OSMImporter2.OSMImporter2.html">uxsim.OSMImporter2.OSMImporter2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/uxsim.ResultGUIViewer.ResultGUIViewer.html">uxsim.ResultGUIViewer.ResultGUIViewer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/uxsim.uxsim.html">uxsim.uxsim</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/uxsim.utils.html">uxsim.utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/uxsim.scenario_reader_writer.html">uxsim.scenario_reader_writer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/uxsim.ResultGUIViewer.ResultGUIViewer.html">uxsim.ResultGUIViewer.ResultGUIViewer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/uxsim.TaxiHandler.TaxiHandler.html">uxsim.TaxiHandler.TaxiHandler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/uxsim.Utilities.Utilities.html">uxsim.Utilities.Utilities</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/notebooks/demo_notebook_09en_dynamic_traffic_assignment.ipynb.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="Dynamic-Traffic-Assignments:-DUO,-DUE,-DSO">
<h1>Dynamic Traffic Assignments: DUO, DUE, DSO<a class="headerlink" href="#Dynamic-Traffic-Assignments:-DUO,-DUE,-DSO" title="Link to this heading">¶</a></h1>
<p>There are 3 famous route choice principles for dynamic traffic assignments (DTA) (the definition varies depending on the terminology).</p>
<ul class="simple">
<li><p>Dynamic User Optimal (DUO): Travelers choose the shortest path based on the instantaneous travel time (the current average speed).</p></li>
<li><p>Dynamic User Equilibrium (DUE): Travelers choose the shortest path based on the actual travel time.</p></li>
<li><p>Dynamic System Optimal (DSO): Travelers choose the path so that the total travel time is minimized.</p></li>
</ul>
<p>The important point of DTA is that travel time may change as the time progresses. Therefore, in the DUO, the chosen route may turn out not to be the actual shortest path after the traveler completes their trip, as the travel time may change during their trip. Similarly, in the DUE, the “actual travel time” is unknown when the traveler choose the route, as it depends on the future travel time. Likewise, in the DSO, it is not obvious which path minimizes the total travel time.</p>
<p>The default routing principle of UXsim is based on DUO, because it is reasonable and very easy to compute.</p>
<p>DUE and DSO are also important as theoretical benchmarks. Due to the aforementioned complexity, it is known that they are difficult to solve especially when the network is large. But, for small or mid scale networks with relatively small number of platoons, their approximate solutions can be obtained by UXsim. The solvers for DTA problems are implemented as <code class="docutils literal notranslate"><span class="pre">uxsim.DTAsolvers</span></code> submodule. In this notebook, we demonstrate their behaviors.</p>
<p>Techical notes for experienced readers. In this demonstration, we consider the route choice problem only. In the other words, we do not consider the departure time problem, and the departure time of each traveler is assumed to be fixed.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pylab</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">uxsim</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">uxsim.DTAsolvers</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
<section id="Two-route-network-with-parallel-highway-and-arterial">
<h2>Two route network with parallel highway and arterial<a class="headerlink" href="#Two-route-network-with-parallel-highway-and-arterial" title="Link to this heading">¶</a></h2>
<p>We simulate a simple toy network with a route choice option. In order to use the identical scenario in multiple simulations efficiently, we define the following function that setup a World object with the identical conditions.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># scenario definition</span>
<span class="k">def</span><span class="w"> </span><span class="nf">create_World</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A function that returns World object with scenario informaiton. This is faster way to reuse the same scenario, as `World.copy` or `World.load_scenario` takes some computation time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">W</span> <span class="o">=</span> <span class="n">uxsim</span><span class="o">.</span><span class="n">World</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">deltan</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">tmax</span><span class="o">=</span><span class="mi">6000</span><span class="p">,</span>
        <span class="n">print_mode</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">save_mode</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">show_mode</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">vehicle_logging_timestep_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">hard_deterministic_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span>
    <span class="p">)</span>

    <span class="n">W</span><span class="o">.</span><span class="n">addNode</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">W</span><span class="o">.</span><span class="n">addNode</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">W</span><span class="o">.</span><span class="n">addNode</span><span class="p">(</span><span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">W</span><span class="o">.</span><span class="n">addNode</span><span class="p">(</span><span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">W</span><span class="o">.</span><span class="n">addNode</span><span class="p">(</span><span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">W</span><span class="o">.</span><span class="n">addNode</span><span class="p">(</span><span class="s2">&quot;6&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">W</span><span class="o">.</span><span class="n">addNode</span><span class="p">(</span><span class="s2">&quot;7&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>

    <span class="n">W</span><span class="o">.</span><span class="n">addLink</span><span class="p">(</span><span class="s2">&quot;highway12&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">number_of_lanes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">merge_priority</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">W</span><span class="o">.</span><span class="n">addLink</span><span class="p">(</span><span class="s2">&quot;highway23&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">number_of_lanes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">merge_priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">capacity_out</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    <span class="n">W</span><span class="o">.</span><span class="n">addLink</span><span class="p">(</span><span class="s2">&quot;highway37&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;7&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">number_of_lanes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">merge_priority</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">W</span><span class="o">.</span><span class="n">addLink</span><span class="p">(</span><span class="s2">&quot;onramp&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">number_of_lanes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">merge_priority</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">W</span><span class="o">.</span><span class="n">addLink</span><span class="p">(</span><span class="s2">&quot;arterial45&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">free_flow_speed</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">number_of_lanes</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">merge_priority</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">W</span><span class="o">.</span><span class="n">addLink</span><span class="p">(</span><span class="s2">&quot;arterial56&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="s2">&quot;6&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">free_flow_speed</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">number_of_lanes</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">merge_priority</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">W</span><span class="o">.</span><span class="n">addLink</span><span class="p">(</span><span class="s2">&quot;arterial67&quot;</span><span class="p">,</span> <span class="s2">&quot;6&quot;</span><span class="p">,</span> <span class="s2">&quot;7&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">free_flow_speed</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">number_of_lanes</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">merge_priority</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="n">W</span><span class="o">.</span><span class="n">adddemand</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;7&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
    <span class="n">W</span><span class="o">.</span><span class="n">adddemand</span><span class="p">(</span><span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;7&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="mf">0.4</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">W</span>
</pre></div>
</div>
</div>
<p>The network structure is as follows. Vehicles travel from nodes “1” and “4” at the left to node “7” at the right. The upper route is a <em>highway</em>, and the bottom is an <em>arterial road</em>. The highway has faster maximum speed but smaller traffic capacity compared with the arterial road. Vehicles from “3” can choose either highway or arterial, depending on the traffic condition.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">W</span> <span class="o">=</span> <span class="n">create_World</span><span class="p">()</span>
<span class="n">W</span><span class="o">.</span><span class="n">show_network</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_6_0.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_6_0.png" />
</div>
</div>
<p>For later use, we define the following visualization function to visualize simulation results.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">visualizaion_helper_function</span><span class="p">(</span><span class="n">W</span><span class="p">):</span>
    <span class="n">W</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">print_simple_stats</span><span class="p">(</span><span class="n">force_print</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">W</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">network_average</span><span class="p">(</span><span class="n">legend_outside</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">r1</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">defRoute</span><span class="p">([</span><span class="s2">&quot;arterial45&quot;</span><span class="p">,</span> <span class="s2">&quot;onramp&quot;</span><span class="p">,</span> <span class="s2">&quot;highway23&quot;</span><span class="p">,</span> <span class="s2">&quot;highway37&quot;</span><span class="p">])</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">defRoute</span><span class="p">([</span><span class="s2">&quot;arterial45&quot;</span><span class="p">,</span> <span class="s2">&quot;arterial56&quot;</span><span class="p">,</span> <span class="s2">&quot;arterial67&quot;</span><span class="p">])</span>

    <span class="n">W</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">time_space_diagram_traj_links</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">links</span><span class="p">)</span>
    <span class="n">W</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">time_space_diagram_traj_links</span><span class="p">(</span><span class="n">r2</span><span class="o">.</span><span class="n">links</span><span class="p">)</span>

    <span class="n">ttt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">W</span><span class="o">.</span><span class="n">TIME</span><span class="p">,</span> <span class="n">W</span><span class="o">.</span><span class="n">TSIZE</span><span class="p">)</span>
    <span class="n">tt1</span> <span class="o">=</span> <span class="p">[</span><span class="n">r1</span><span class="o">.</span><span class="n">actual_travel_time</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ttt</span><span class="p">]</span>
    <span class="n">tt2</span> <span class="o">=</span> <span class="p">[</span><span class="n">r2</span><span class="o">.</span><span class="n">actual_travel_time</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ttt</span><span class="p">]</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ttt</span><span class="p">,</span> <span class="n">tt1</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;r1&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ttt</span><span class="p">,</span> <span class="n">tt2</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;r2&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;travel time&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;cumlative count&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ttt</span><span class="p">,</span> <span class="n">W</span><span class="o">.</span><span class="n">get_link</span><span class="p">(</span><span class="s2">&quot;onramp&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cum_arrival</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;highway (r1)&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ttt</span><span class="p">,</span> <span class="n">W</span><span class="o">.</span><span class="n">get_link</span><span class="p">(</span><span class="s2">&quot;arterial56&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cum_arrival</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;arterial (r2)&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<section id="DUO">
<h3>DUO<a class="headerlink" href="#DUO" title="Link to this heading">¶</a></h3>
<p>DUO can be simulated by the default procedure of UXsim as follows.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># DUO (default)</span>

<span class="n">W_DUO</span> <span class="o">=</span> <span class="n">create_World</span><span class="p">()</span>
<span class="n">W_DUO</span><span class="o">.</span><span class="n">exec_simulation</span><span class="p">()</span>
<span class="n">W_DUO</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">print_simple_stats</span><span class="p">(</span><span class="n">force_print</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_DUO</span> <span class="o">=</span> <span class="n">W_DUO</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">basic_to_pandas</span><span class="p">()</span>

<span class="n">visualizaion_helper_function</span><span class="p">(</span><span class="n">W_DUO</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
results:
 average speed:  9.6 m/s
 number of completed trips:      4500 / 4500
 total travel time:              4046400.0 s
 average travel time of trips:   899.2 s
 average delay of trips:         569.2 s
 delay ratio:                    0.633
 total distance traveled:        23580000.0 m
results:
 average speed:  9.6 m/s
 number of completed trips:      4500 / 4500
 total travel time:              4046400.0 s
 average travel time of trips:   899.2 s
 average delay of trips:         569.2 s
 delay ratio:                    0.633
 total distance traveled:        23580000.0 m
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_10_1.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_10_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_10_2.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_10_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_10_3.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_10_3.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_10_4.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_10_4.png" />
</div>
</div>
<p>In DUO, you can see that many vehicles chose the highway route at the early stage of the simulation due to the fast maximum speed. It then caused a significant traffic jam, resulting a longer travel time. This demonstrates the myopic nature of DUO routing principle.</p>
</section>
<section id="DUE">
<h3>DUE<a class="headerlink" href="#DUE" title="Link to this heading">¶</a></h3>
<p>Approximate solution of DUE can be obtained by <code class="docutils literal notranslate"><span class="pre">SolverDUE</span></code> function as follows. The solution is not exact as exact DUE (in which every driver chooses the route with least travel cost) is very difficult to compute. In easy terms, the approximate DUE means that each driver chooses routes with the least expected cost when the cost is averaged for several days.</p>
<p>More specifically (you can skip the following explanation as it is a bit technical), this function computes a near dynamic user equilibrium state as a steady state of day-to-day dynamical routing game. On day <code class="docutils literal notranslate"><span class="pre">i</span></code>, vehicles choose their route based on actual travel time on day <code class="docutils literal notranslate"><span class="pre">i-1</span></code> with the same departure time. If there are shorter travel time route, they will change with probability <code class="docutils literal notranslate"><span class="pre">swap_prob</span></code>. This process is repeated until <code class="docutils literal notranslate"><span class="pre">max_iter</span></code> day. It is expected that this process eventually
reach a steady state. Due to the problem complexity, it does not necessarily reach or converge to Nash equilibrium or any other stationary points. However, in the literature, it is argued that the steady state can be considered as a reasonable proxy for Nash equilibrium or dynamic equilibrium state. There are some theoretical background for it; but intuitively speaking, the steady state can be considered as a realistic state that people’s rational behavior will reach.</p>
<p>This method is based on the following literature:</p>
<ul class="simple">
<li><p>Ishihara, M., &amp; Iryo, T. (2015). Dynamic Traffic Assignment by Markov Chain. Journal of Japan Society of Civil Engineers, Ser. D3 (Infrastructure Planning and Management), 71(5), I_503-I_509. (in Japanese). <a class="reference external" href="https://doi.org/10.2208/jscejipm.71.I_503">https://doi.org/10.2208/jscejipm.71.I_503</a></p></li>
<li><p>Iryo, T., Urata, J., &amp; Kawase, R. (2024). Traffic Flow Simulator and Travel Demand Simulators for Assessing Congestion on Roads After a Major Earthquake. In APPLICATION OF HIGH-PERFORMANCE COMPUTING TO EARTHQUAKE-RELATED PROBLEMS (pp. 413-447). <a class="reference external" href="https://doi.org/10.1142/9781800614635_0007">https://doi.org/10.1142/9781800614635_0007</a></p></li>
<li><p>Iryo, T., Watling, D., &amp; Hazelton, M. (2024). Estimating Markov Chain Mixing Times: Convergence Rate Towards Equilibrium of a Stochastic Process Traffic Assignment Model. Transportation Science. <a class="reference external" href="https://doi.org/10.1287/trsc.2024.0523">https://doi.org/10.1287/trsc.2024.0523</a></p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># DUE</span>
<span class="n">solver_DUE</span> <span class="o">=</span> <span class="n">SolverDUE</span><span class="p">(</span><span class="n">create_World</span><span class="p">)</span>
<span class="n">solver_DUE</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">print_progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">W_DUE</span> <span class="o">=</span> <span class="n">solver_DUE</span><span class="o">.</span><span class="n">W_sol</span>
<span class="n">W_DUE</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">print_simple_stats</span><span class="p">(</span><span class="n">force_print</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_DUE</span> <span class="o">=</span> <span class="n">W_DUE</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">basic_to_pandas</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
solving DUE...
DUE summary:
 total travel time: initial 4046400.0 -&gt; average of last 25 iters 3221200.0
 number of potential route changes: initial 1580.0 -&gt; average of last 25 iters 1144.8
 route travel time gap: initial 57.2 -&gt; average of last 25 iters 13.9
 computation time: 5.0 seconds
results:
 average speed:  11.3 m/s
 number of completed trips:      4500 / 4500
 total travel time:              3190400.0 s
 average travel time of trips:   709.0 s
 average delay of trips:         379.0 s
 delay ratio:                    0.535
 total distance traveled:        23840000.0 m
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visualizaion_helper_function</span><span class="p">(</span><span class="n">W_DUE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
results:
 average speed:  11.3 m/s
 number of completed trips:      4500 / 4500
 total travel time:              3190400.0 s
 average travel time of trips:   709.0 s
 average delay of trips:         379.0 s
 delay ratio:                    0.535
 total distance traveled:        23840000.0 m
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_14_1.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_14_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_14_2.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_14_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_14_3.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_14_3.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_14_4.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_14_4.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">solver_DUE</span><span class="o">.</span><span class="n">plot_convergence</span><span class="p">()</span>
<span class="n">solver_DUE</span><span class="o">.</span><span class="n">plot_link_stats</span><span class="p">()</span>
<span class="n">solver_DUE</span><span class="o">.</span><span class="n">plot_vehicle_stats</span><span class="p">(</span><span class="n">orig</span><span class="o">=</span><span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;7&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_15_0.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_15_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_15_1.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_15_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_15_2.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_15_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_15_3.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_15_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_15_4.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_15_4.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_15_5.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_15_5.png" />
</div>
</div>
<p>In DUE, you can see that cost is more balanced than DUO. For example, the plot “travel time difference between chosen route and minimum cost route” shows that it is reduced from 60 sec in DUO (the initial solution) to 10-20 sec in the final solution.</p>
<p>As a result of the travelers’ smart decision making, the total travel time of DUE is reduced to about 3 200 000 sec from 4 000 000 sec in the DUO where travelers are myopic. Note that these numbers may be different for each simulation as the algorithm is stochastic.</p>
</section>
<section id="DSO">
<h3>DSO<a class="headerlink" href="#DSO" title="Link to this heading">¶</a></h3>
<p>Now we compute DSO solution. To obtain the solution, we use a similar iterative algorithm to the previous DUE example. In this algorithm, each traveler tries to minimize their marginal travel time (i.e., private cost + externality) instead of the private cost as in DUE.</p>
<p>This algorithm is a loose generalization of “DSO game” of the following paper:</p>
<ul class="simple">
<li><p>Satsukawa, K., Wada, K., &amp; Watling, D. (2022). Dynamic system optimal traffic assignment with atomic users: Convergence and stability. Transportation Research Part B: Methodological, 155, 188-209.</p></li>
</ul>
<p>In this paper, it is theoretically guaranteed that their DSO game algorithm converges to the global optimal DSO state. However, it may take a long time. This <code class="docutils literal notranslate"><span class="pre">SolverDSO_D2D</span></code> speeds up the solution process significantly, but it weakens the convergence guarantee.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># DSO by ALNS</span>
<span class="n">solver_DSO</span> <span class="o">=</span> <span class="n">SolverDSO_D2D</span><span class="p">(</span><span class="n">create_World</span><span class="p">)</span>
<span class="n">solver_DSO</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">print_progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">W_DSO</span> <span class="o">=</span> <span class="n">solver_DSO</span><span class="o">.</span><span class="n">W_sol</span>
<span class="n">W_DSO</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">print_simple_stats</span><span class="p">(</span><span class="n">force_print</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_DSO</span> <span class="o">=</span> <span class="n">W_DSO</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">basic_to_pandas</span><span class="p">()</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
solving DSO...
DSO summary:
 total travel time: initial 4046400.0 -&gt; minimum 2962800.0
 number of potential route changes: initial 1660.0 -&gt; minimum 960.0
 route marginal travel time gap: initial 8825.7 -&gt; minimum 137.5
 computation time: 2.9 seconds
results:
 average speed:  0.0 m/s
 number of completed trips:      4500 / 4500
 total travel time:              2962800.0 s
 average travel time of trips:   658.4 s
 average delay of trips:         328.4 s
 delay ratio:                    0.499
 total distance traveled:        23520000.0 m
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visualizaion_helper_function</span><span class="p">(</span><span class="n">W_DSO</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
results:
 average speed:  0.0 m/s
 number of completed trips:      4500 / 4500
 total travel time:              2962800.0 s
 average travel time of trips:   658.4 s
 average delay of trips:         328.4 s
 delay ratio:                    0.499
 total distance traveled:        23520000.0 m
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_19_1.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_19_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
LoggingWarning: vehicle_logging_timestep_interval is not 1. The plot is not exactly accurate.
LoggingWarning: vehicle_logging_timestep_interval is not 1. The trajecotries are not exactly accurate.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_19_3.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_19_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_19_4.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_19_4.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_19_5.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_19_5.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">solver_DSO</span><span class="o">.</span><span class="n">plot_convergence</span><span class="p">()</span>
<span class="n">solver_DSO</span><span class="o">.</span><span class="n">plot_link_stats</span><span class="p">()</span>
<span class="n">solver_DSO</span><span class="o">.</span><span class="n">plot_vehicle_stats</span><span class="p">(</span><span class="n">orig</span><span class="o">=</span><span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;7&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_20_0.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_20_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_20_1.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_20_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_20_2.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_20_2.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_20_3.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_20_3.png" />
</div>
</div>
<p>You can see that the congestion is almost eliminated. The total travel time is 3 000 000 sec in DSO. This is more efficient than DUE (with about 3 200 000 sec) or DUO (with about 4 000 000 sec).</p>
<p>However, some travelers are enforced to choose routes with longer travel time to improve the efficiency of the entire system.</p>
</section>
<section id="Comparison">
<h3>Comparison<a class="headerlink" href="#Comparison" title="Link to this heading">¶</a></h3>
<p>Comparison of 3 cases.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_DUO</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;DUO&#39;</span>
<span class="n">df_DUE</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;DUE&#39;</span>
<span class="n">df_DSO</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;DSO&#39;</span>

<span class="n">df_combined</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_DUO</span><span class="p">,</span> <span class="n">df_DUE</span><span class="p">,</span> <span class="n">df_DSO</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_combined</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="s1">&#39;Name&#39;</span><span class="p">]</span>
<span class="n">df_combined</span> <span class="o">=</span> <span class="n">df_combined</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_combined</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>total_trips</th>
      <th>completed_trips</th>
      <th>total_travel_time</th>
      <th>average_travel_time</th>
      <th>total_delay</th>
      <th>average_delay</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>DUO</td>
      <td>4500</td>
      <td>4500</td>
      <td>4046400.0</td>
      <td>899.200000</td>
      <td>2561400.0</td>
      <td>569.200000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>DUE</td>
      <td>4500</td>
      <td>4500</td>
      <td>3190400.0</td>
      <td>708.977778</td>
      <td>1705400.0</td>
      <td>378.977778</td>
    </tr>
    <tr>
      <th>2</th>
      <td>DSO</td>
      <td>4500</td>
      <td>4500</td>
      <td>2962800.0</td>
      <td>658.400000</td>
      <td>1477800.0</td>
      <td>328.400000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
</section>
<section id="Large-scale-scenario">
<h2>Large-scale scenario<a class="headerlink" href="#Large-scale-scenario" title="Link to this heading">¶</a></h2>
<p>Now we show larger example.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">uxsim</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">uxsim</span><span class="w"> </span><span class="kn">import</span> <span class="n">DTAsolvers</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_World</span><span class="p">():</span>
    <span class="c1"># simulation world</span>
    <span class="n">W</span> <span class="o">=</span> <span class="n">uxsim</span><span class="o">.</span><span class="n">World</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">deltan</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">tmax</span><span class="o">=</span><span class="mi">4800</span><span class="p">,</span>
        <span class="n">duo_update_time</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">print_mode</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">save_mode</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">show_mode</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># scenario</span>
    <span class="c1">#automated network generation</span>
    <span class="c1">#deploy nodes as an imax x jmax grid</span>
    <span class="n">imax</span> <span class="o">=</span> <span class="mi">9</span>
    <span class="n">jmax</span> <span class="o">=</span> <span class="mi">9</span>
    <span class="n">id_center</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">imax</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">jmax</span><span class="p">):</span>
            <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">addNode</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n</span><span class="si">{</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">flow_capacity</span><span class="o">=</span><span class="mf">1.6</span><span class="p">)</span>

    <span class="c1">#create links between neighborhood nodes</span>
    <span class="n">links</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">imax</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">jmax</span><span class="p">):</span>
            <span class="n">free_flow_speed</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">imax</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">id_center</span><span class="p">:</span>
                    <span class="n">free_flow_speed</span> <span class="o">=</span> <span class="mi">20</span>
                <span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">addLink</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;l</span><span class="si">{</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">free_flow_speed</span><span class="o">=</span><span class="n">free_flow_speed</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">id_center</span><span class="p">:</span>
                    <span class="n">free_flow_speed</span> <span class="o">=</span> <span class="mi">20</span>
                <span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">addLink</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;l</span><span class="si">{</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">free_flow_speed</span><span class="o">=</span><span class="n">free_flow_speed</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">jmax</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">id_center</span><span class="p">:</span>
                    <span class="n">free_flow_speed</span> <span class="o">=</span> <span class="mi">20</span>
                <span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">addLink</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;l</span><span class="si">{</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">free_flow_speed</span><span class="o">=</span><span class="n">free_flow_speed</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">id_center</span><span class="p">:</span>
                    <span class="n">free_flow_speed</span> <span class="o">=</span> <span class="mi">20</span>
                <span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">addLink</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;l</span><span class="si">{</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">free_flow_speed</span><span class="o">=</span><span class="n">free_flow_speed</span><span class="p">)</span>

    <span class="c1">#generate traffic demand between the boundary nodes</span>
    <span class="n">demand_flow</span> <span class="o">=</span> <span class="mf">0.08</span>
    <span class="n">demand_duration</span> <span class="o">=</span> <span class="mi">2400</span>
    <span class="n">outer_ids</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">for</span> <span class="n">n1</span> <span class="ow">in</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">outer_ids</span><span class="p">,</span> <span class="n">jmax</span><span class="o">-</span><span class="n">outer_ids</span><span class="p">)]:</span>
        <span class="k">for</span> <span class="n">n2</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">imax</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">outer_ids</span><span class="p">,</span><span class="n">jmax</span><span class="o">-</span><span class="n">outer_ids</span><span class="p">)]:</span>
            <span class="n">W</span><span class="o">.</span><span class="n">adddemand</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">n1</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="n">n2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">demand_duration</span><span class="p">,</span> <span class="n">demand_flow</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n2</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">jmax</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">outer_ids</span><span class="p">,</span> <span class="n">imax</span><span class="o">-</span><span class="n">outer_ids</span><span class="p">)]:</span>
            <span class="n">W</span><span class="o">.</span><span class="n">adddemand</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">n1</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="n">n2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">demand_duration</span><span class="p">,</span> <span class="n">demand_flow</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n1</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">outer_ids</span><span class="p">,</span> <span class="n">imax</span><span class="o">-</span><span class="n">outer_ids</span><span class="p">)]:</span>
        <span class="k">for</span> <span class="n">n2</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">jmax</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">outer_ids</span><span class="p">,</span> <span class="n">imax</span><span class="o">-</span><span class="n">outer_ids</span><span class="p">)]:</span>
            <span class="n">W</span><span class="o">.</span><span class="n">adddemand</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">n1</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="n">n2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">demand_duration</span><span class="p">,</span> <span class="n">demand_flow</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n2</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">imax</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">outer_ids</span><span class="p">,</span><span class="n">jmax</span><span class="o">-</span><span class="n">outer_ids</span><span class="p">)]:</span>
            <span class="n">W</span><span class="o">.</span><span class="n">adddemand</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">n1</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="n">n2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">demand_duration</span><span class="p">,</span> <span class="n">demand_flow</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">W</span>

<span class="n">W</span> <span class="o">=</span> <span class="n">create_World</span><span class="p">()</span>
<span class="n">W</span><span class="o">.</span><span class="n">change_print_mode</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">W</span><span class="o">.</span><span class="n">show_network</span><span class="p">(</span><span class="n">network_font_size</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_25_0.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_25_0.png" />
</div>
</div>
<p>In this grid network, central links (links at x=4 and y=4) have faster free-flow speed of 20 m/s. The rest of links are with free-flow speed of 10 m/s. And the following four types of demands are generated:</p>
<ul class="simple">
<li><p>bottom edge (3 nodes at (3,0), (4,0), (5,0)) to top (3 nodes at (3,8), (4,8), (5,8))</p></li>
<li><p>bottom edge to right</p></li>
<li><p>left edge to top</p></li>
<li><p>left to right</p></li>
</ul>
<p>This is a deliberately inefficient setting that causes congestion. In a free-flowing condition, travelers tend to choose the central links. However, because traffic capacity of central links is limited, it may cause congestion although many other links are empty. To enhance system’s performance, some travelers need to be distributed to slower links to efficiently utilize the network capacity.</p>
<section id="id1">
<h3>DUO<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h3>
<p>First, let’s compute DUO solution.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># execute simulation</span>
<span class="n">W</span><span class="o">.</span><span class="n">exec_simulation</span><span class="p">()</span>

<span class="c1"># visualize</span>
<span class="n">W</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">print_simple_stats</span><span class="p">(</span><span class="n">force_print</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">W</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">network_average</span><span class="p">(</span><span class="n">network_font_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend_outside</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">W_DUO</span> <span class="o">=</span> <span class="n">W</span>
<span class="n">df_DUO</span> <span class="o">=</span> <span class="n">W_DUO</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">basic_to_pandas</span><span class="p">()</span>

<span class="n">W_DUO</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">network_anim</span><span class="p">(</span><span class="n">state_variables</span><span class="o">=</span><span class="s2">&quot;flow_speed&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">animation_speed_inverse</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">timestep_skip</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">detailed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">network_font_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;out/anim_DUO.gif&quot;</span><span class="p">)</span>
<span class="n">uxsim</span><span class="o">.</span><span class="n">display_image_in_notebook</span><span class="p">(</span><span class="s2">&quot;out/anim_DUO.gif&quot;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
    4800 s|        0 vehs|   0.0 m/s|     5.58 s
 simulation finished
results:
 average speed:  9.6 m/s
 number of completed trips:      6840 / 6840
 total travel time:              6663000.0 s
 average travel time of trips:   974.1 s
 average delay of trips:         457.5 s
 delay ratio:                    0.470
 total distance traveled:        62120000.0 m
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_27_1.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_27_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 generating animation...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "1f24f560e6f648499b124a95fed80045", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_27_4.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_27_4.png" />
</div>
</div>
<p>The aforementioned expected behaviors are confirmed. Many travelers choose the central links first (thick width = high flow) and created congestion (red color = congestion). After that, some travelers avoided the center links. However, the overall efficiency is not good, with 0.47 delay ratio.</p>
</section>
<section id="id2">
<h3>DUE<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h3>
<p>Now we compute DUE solution.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">solver_DUE</span> <span class="o">=</span> <span class="n">DTAsolvers</span><span class="o">.</span><span class="n">SolverDUE</span><span class="p">(</span><span class="n">create_World</span><span class="p">)</span>
<span class="n">solver_DUE</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">n_routes_per_od</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">W_DUE</span> <span class="o">=</span> <span class="n">solver_DUE</span><span class="o">.</span><span class="n">W_sol</span>
<span class="n">W_DUE</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">print_simple_stats</span><span class="p">(</span><span class="n">force_print</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">W_DUE</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">network_average</span><span class="p">(</span><span class="n">network_font_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_DUE</span> <span class="o">=</span> <span class="n">W_DUE</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">basic_to_pandas</span><span class="p">()</span>

<span class="n">W_DUE</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">network_anim</span><span class="p">(</span><span class="n">state_variables</span><span class="o">=</span><span class="s2">&quot;flow_speed&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">animation_speed_inverse</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">timestep_skip</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">detailed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">network_font_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;out/anim_DUE.gif&quot;</span><span class="p">)</span>
<span class="n">uxsim</span><span class="o">.</span><span class="n">display_image_in_notebook</span><span class="p">(</span><span class="s2">&quot;out/anim_DUE.gif&quot;</span><span class="p">)</span>

<span class="n">solver_DUE</span><span class="o">.</span><span class="n">plot_convergence</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
simulation setting (not finalized):
 scenario name:
 simulation duration:    4800 s
 number of vehicles:     6840 veh
 total road length:      288000 m
 time discret. width:    10 s
 platoon size:           10 veh
 number of timesteps:    480.0
 number of platoons:     684
 number of links:        288
 number of nodes:        81
 setup time:             0.01 s
number of OD pairs: 6561, number of routes: 121733
solving DUE...
 iter 0: time gap: 127.2, potential route change: 4790, route change: 230, total travel time:  6663000.0, delay ratio:  0.470
 iter 1: time gap: 129.8, potential route change: 4450, route change: 150, total travel time:  6783700.0, delay ratio:  0.479
 iter 2: time gap: 123.2, potential route change: 4500, route change: 210, total travel time:  6729100.0, delay ratio:  0.475
 iter 3: time gap: 114.3, potential route change: 4320, route change: 210, total travel time:  6662800.0, delay ratio:  0.470
 iter 4: time gap: 100.7, potential route change: 4370, route change: 240, total travel time:  6521500.0, delay ratio:  0.458
 iter 5: time gap: 102.6, potential route change: 4100, route change: 170, total travel time:  6629700.0, delay ratio:  0.467
 iter 6: time gap: 101.8, potential route change: 4230, route change: 210, total travel time:  6742800.0, delay ratio:  0.476
 iter 7: time gap: 99.2, potential route change: 4110, route change: 190, total travel time:  6594100.0, delay ratio:  0.464
 iter 8: time gap: 93.3, potential route change: 4020, route change: 180, total travel time:  6512500.0, delay ratio:  0.457
 iter 9: time gap: 99.7, potential route change: 4020, route change: 190, total travel time:  6645900.0, delay ratio:  0.468
 iter 10: time gap: 87.7, potential route change: 4090, route change: 160, total travel time:  6457500.0, delay ratio:  0.453
 iter 11: time gap: 75.6, potential route change: 4150, route change: 260, total travel time:  6215000.0, delay ratio:  0.431
 iter 12: time gap: 82.4, potential route change: 4180, route change: 200, total travel time:  6301700.0, delay ratio:  0.439
 iter 13: time gap: 76.9, potential route change: 3920, route change: 210, total travel time:  6246900.0, delay ratio:  0.434
 iter 14: time gap: 68.2, potential route change: 4030, route change: 230, total travel time:  6170400.0, delay ratio:  0.427
 iter 15: time gap: 64.8, potential route change: 4060, route change: 220, total travel time:  6053400.0, delay ratio:  0.416
 iter 16: time gap: 57.8, potential route change: 4030, route change: 220, total travel time:  5988700.0, delay ratio:  0.410
 iter 17: time gap: 60.5, potential route change: 3710, route change: 160, total travel time:  6163700.0, delay ratio:  0.427
 iter 18: time gap: 59.3, potential route change: 4160, route change: 230, total travel time:  5922700.0, delay ratio:  0.403
 iter 19: time gap: 53.2, potential route change: 3940, route change: 150, total travel time:  5941700.0, delay ratio:  0.405
 iter 20: time gap: 47.3, potential route change: 3810, route change: 220, total travel time:  5878600.0, delay ratio:  0.399
 iter 21: time gap: 55.4, potential route change: 4280, route change: 140, total travel time:  5740400.0, delay ratio:  0.384
 iter 22: time gap: 49.7, potential route change: 4180, route change: 170, total travel time:  5823800.0, delay ratio:  0.393
 iter 23: time gap: 45.2, potential route change: 4160, route change: 280, total travel time:  5738200.0, delay ratio:  0.384
 iter 24: time gap: 51.4, potential route change: 4050, route change: 220, total travel time:  5776700.0, delay ratio:  0.388
 iter 25: time gap: 44.7, potential route change: 4050, route change: 200, total travel time:  5702400.0, delay ratio:  0.380
 iter 26: time gap: 45.0, potential route change: 3820, route change: 200, total travel time:  5716400.0, delay ratio:  0.382
 iter 27: time gap: 45.3, potential route change: 3880, route change: 260, total travel time:  5729800.0, delay ratio:  0.383
 iter 28: time gap: 46.8, potential route change: 4110, route change: 140, total travel time:  5838800.0, delay ratio:  0.395
 iter 29: time gap: 43.3, potential route change: 3850, route change: 240, total travel time:  5757200.0, delay ratio:  0.386
 iter 30: time gap: 42.8, potential route change: 3730, route change: 160, total travel time:  5750400.0, delay ratio:  0.385
 iter 31: time gap: 42.5, potential route change: 3830, route change: 160, total travel time:  5704800.0, delay ratio:  0.381
 iter 32: time gap: 42.0, potential route change: 3870, route change: 170, total travel time:  5717600.0, delay ratio:  0.382
 iter 33: time gap: 40.5, potential route change: 3990, route change: 130, total travel time:  5604700.0, delay ratio:  0.369
 iter 34: time gap: 36.5, potential route change: 3620, route change: 240, total travel time:  5566100.0, delay ratio:  0.365
 iter 35: time gap: 45.5, potential route change: 4050, route change: 220, total travel time:  5610200.0, delay ratio:  0.370
 iter 36: time gap: 38.2, potential route change: 3600, route change: 190, total travel time:  5610100.0, delay ratio:  0.370
 iter 37: time gap: 38.9, potential route change: 3670, route change: 200, total travel time:  5719300.0, delay ratio:  0.382
 iter 38: time gap: 43.2, potential route change: 3780, route change: 240, total travel time:  5706300.0, delay ratio:  0.381
 iter 39: time gap: 40.6, potential route change: 3830, route change: 150, total travel time:  5685900.0, delay ratio:  0.378
 iter 40: time gap: 44.5, potential route change: 3890, route change: 190, total travel time:  5817700.0, delay ratio:  0.393
 iter 41: time gap: 44.0, potential route change: 3980, route change: 230, total travel time:  5883500.0, delay ratio:  0.399
 iter 42: time gap: 35.8, potential route change: 3890, route change: 160, total travel time:  5646000.0, delay ratio:  0.374
 iter 43: time gap: 35.6, potential route change: 3750, route change: 190, total travel time:  5649100.0, delay ratio:  0.374
 iter 44: time gap: 38.4, potential route change: 3940, route change: 240, total travel time:  5703000.0, delay ratio:  0.380
 iter 45: time gap: 37.5, potential route change: 3820, route change: 160, total travel time:  5675800.0, delay ratio:  0.377
 iter 46: time gap: 35.5, potential route change: 3850, route change: 120, total travel time:  5599600.0, delay ratio:  0.369
 iter 47: time gap: 34.9, potential route change: 3850, route change: 190, total travel time:  5506200.0, delay ratio:  0.358
 iter 48: time gap: 35.3, potential route change: 3890, route change: 200, total travel time:  5663000.0, delay ratio:  0.376
 iter 49: time gap: 33.6, potential route change: 3740, route change: 220, total travel time:  5563500.0, delay ratio:  0.365
DUE summary:
 total travel time: initial 6663000.0 -&gt; average of last 12 iters 5674966.7
 number of potential route changes: initial 4790.0 -&gt; average of last 12 iters 3850.8
 route travel time gap: initial 127.2 -&gt; average of last 12 iters 38.2
 computation time: 32.4 seconds
results:
 average speed:  11.2 m/s
 number of completed trips:      6840 / 6840
 total travel time:              5563500.0 s
 average travel time of trips:   813.4 s
 average delay of trips:         296.7 s
 delay ratio:                    0.365
 total distance traveled:        59860000.0 m
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_29_1.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_29_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_29_2.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_29_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_29_3.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_29_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_29_4.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_29_4.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_29_5.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_29_5.png" />
</div>
</div>
<p>The algorithm successfully converged to a steady state, and it can be considered as a quasi-DUE state.</p>
<p>According to “time gap” coefficient, the DUO solution has about 140 s of time gap. This is the average time difference of route chosen by travelers and the actual minimum cost route. Since travelers in DUO are myopic, it is reasonable to have large time gap value. In the quasi-DUE state, the average time gap was reduced to about 40 s. Travelers are much smarter than DUO.</p>
<p>In the network animation, you can see that some travelers choose non-central links from the beginning. They anticipated that the central link would be congested and took action to avoid it in advance.</p>
<p>As a result, the total delay ratio was reduced to about 0.38 from 0.47 of DUO.</p>
<p>However, since travelers in DUE is still selfish, this is not optimal for the entire system.</p>
</section>
<section id="id3">
<h3>DSO<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h3>
<p>Now, we compute DSO solution. Note that many local optima exist. It may be required to run the algorithm multiple times to obtain a good result.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">solver_DSO</span> <span class="o">=</span> <span class="n">DTAsolvers</span><span class="o">.</span><span class="n">SolverDSO_D2D</span><span class="p">(</span><span class="n">create_World</span><span class="p">)</span>
<span class="n">solver_DSO</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="n">W_DSO</span> <span class="o">=</span> <span class="n">solver_DSO</span><span class="o">.</span><span class="n">W_sol</span>
<span class="n">W_DSO</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">print_simple_stats</span><span class="p">(</span><span class="n">force_print</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">W_DSO</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">network_average</span><span class="p">(</span><span class="n">network_font_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_DSO</span> <span class="o">=</span> <span class="n">W_DSO</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">basic_to_pandas</span><span class="p">()</span>

<span class="n">W_DSO</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">network_anim</span><span class="p">(</span><span class="n">state_variables</span><span class="o">=</span><span class="s2">&quot;flow_speed&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">animation_speed_inverse</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">timestep_skip</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">detailed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">network_font_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;out/anim_DSO.gif&quot;</span><span class="p">)</span>
<span class="n">uxsim</span><span class="o">.</span><span class="n">display_image_in_notebook</span><span class="p">(</span><span class="s2">&quot;out/anim_DSO.gif&quot;</span><span class="p">)</span>

<span class="n">solver_DSO</span><span class="o">.</span><span class="n">plot_convergence</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
simulation setting (not finalized):
 scenario name:
 simulation duration:    4800 s
 number of vehicles:     6840 veh
 total road length:      288000 m
 time discret. width:    10 s
 platoon size:           10 veh
 number of timesteps:    480.0
 number of platoons:     684
 number of links:        288
 number of nodes:        81
 setup time:             0.01 s
number of OD pairs: 6561, number of routes: 63441
solving DSO...
 iter 0: marginal time gap: 5419.0, potential route change: 5490, route change: 220, total travel time:  6663000.0, delay ratio:  0.470
 iter 1: marginal time gap: 5231.0, potential route change: 5260, route change: 250, total travel time:  6423500.0, delay ratio:  0.450
 iter 2: marginal time gap: 4763.5, potential route change: 5350, route change: 230, total travel time:  6462300.0, delay ratio:  0.453
 iter 3: marginal time gap: 5725.8, potential route change: 5090, route change: 240, total travel time:  6401200.0, delay ratio:  0.448
 iter 4: marginal time gap: 5237.4, potential route change: 5220, route change: 250, total travel time:  6158000.0, delay ratio:  0.426
 iter 5: marginal time gap: 3904.0, potential route change: 5100, route change: 180, total travel time:  5972200.0, delay ratio:  0.408
 iter 6: marginal time gap: 3828.1, potential route change: 5120, route change: 280, total travel time:  5805300.0, delay ratio:  0.391
 iter 7: marginal time gap: 2675.1, potential route change: 5380, route change: 440, total travel time:  5669100.0, delay ratio:  0.377
 iter 8: marginal time gap: 2392.3, potential route change: 5200, route change: 320, total travel time:  5635000.0, delay ratio:  0.373
 iter 9: marginal time gap: 2026.5, potential route change: 5400, route change: 150, total travel time:  5511200.0, delay ratio:  0.359
 iter 10: marginal time gap: 1738.6, potential route change: 5560, route change: 320, total travel time:  5485100.0, delay ratio:  0.356
 iter 11: marginal time gap: 1620.2, potential route change: 5360, route change: 270, total travel time:  5463400.0, delay ratio:  0.353
 iter 12: marginal time gap: 1320.3, potential route change: 5320, route change: 270, total travel time:  5380900.0, delay ratio:  0.343
 iter 13: marginal time gap: 1029.3, potential route change: 5400, route change: 210, total travel time:  5314900.0, delay ratio:  0.335
 iter 14: marginal time gap: 861.9, potential route change: 5260, route change: 410, total travel time:  5292100.0, delay ratio:  0.332
 iter 15: marginal time gap: 518.1, potential route change: 5370, route change: 210, total travel time:  5227800.0, delay ratio:  0.324
 iter 16: marginal time gap: 808.5, potential route change: 5340, route change: 250, total travel time:  5231500.0, delay ratio:  0.324
 iter 17: marginal time gap: 584.7, potential route change: 5290, route change: 300, total travel time:  5204400.0, delay ratio:  0.321
 iter 18: marginal time gap: 486.6, potential route change: 5470, route change: 190, total travel time:  5188100.0, delay ratio:  0.319
 iter 19: marginal time gap: 629.6, potential route change: 5290, route change: 270, total travel time:  5201000.0, delay ratio:  0.321
 iter 20: marginal time gap: 619.0, potential route change: 5310, route change: 280, total travel time:  5190800.0, delay ratio:  0.319
 iter 21: marginal time gap: 700.2, potential route change: 5250, route change: 180, total travel time:  5202500.0, delay ratio:  0.321
 iter 22: marginal time gap: 549.1, potential route change: 5200, route change: 270, total travel time:  5186900.0, delay ratio:  0.319
 iter 23: marginal time gap: 367.7, potential route change: 5390, route change: 250, total travel time:  5150500.0, delay ratio:  0.314
 iter 24: marginal time gap: 462.3, potential route change: 5270, route change: 230, total travel time:  5159000.0, delay ratio:  0.315
 iter 25: marginal time gap: 485.5, potential route change: 5230, route change: 240, total travel time:  5167100.0, delay ratio:  0.316
 iter 26: marginal time gap: 981.6, potential route change: 5160, route change: 280, total travel time:  5198300.0, delay ratio:  0.320
 iter 27: marginal time gap: 493.1, potential route change: 5300, route change: 380, total travel time:  5131400.0, delay ratio:  0.311
 iter 28: marginal time gap: 583.0, potential route change: 5270, route change: 380, total travel time:  5108700.0, delay ratio:  0.308
 iter 29: marginal time gap: 524.0, potential route change: 5080, route change: 290, total travel time:  5093000.0, delay ratio:  0.306
 iter 30: marginal time gap: 904.7, potential route change: 5190, route change: 340, total travel time:  5129500.0, delay ratio:  0.311
 iter 31: marginal time gap: 1282.6, potential route change: 5040, route change: 240, total travel time:  5184500.0, delay ratio:  0.318
 iter 32: marginal time gap: 687.0, potential route change: 5170, route change: 220, total travel time:  5138900.0, delay ratio:  0.312
 iter 33: marginal time gap: 558.3, potential route change: 5240, route change: 280, total travel time:  5126700.0, delay ratio:  0.311
 iter 34: marginal time gap: 700.1, potential route change: 5080, route change: 360, total travel time:  5122600.0, delay ratio:  0.310
 iter 35: marginal time gap: 956.5, potential route change: 5220, route change: 310, total travel time:  5130600.0, delay ratio:  0.311
 iter 36: marginal time gap: 747.5, potential route change: 5200, route change: 250, total travel time:  5101900.0, delay ratio:  0.307
 iter 37: marginal time gap: 722.5, potential route change: 5220, route change: 230, total travel time:  5122100.0, delay ratio:  0.310
 iter 38: marginal time gap: 631.3, potential route change: 5210, route change: 180, total travel time:  5098000.0, delay ratio:  0.307
 iter 39: marginal time gap: 418.5, potential route change: 5170, route change: 250, total travel time:  5083000.0, delay ratio:  0.305
 iter 40: marginal time gap: 551.7, potential route change: 5310, route change: 270, total travel time:  5087600.0, delay ratio:  0.305
 iter 41: marginal time gap: 485.2, potential route change: 5000, route change: 240, total travel time:  5093600.0, delay ratio:  0.306
 iter 42: marginal time gap: 468.1, potential route change: 5240, route change: 360, total travel time:  5078400.0, delay ratio:  0.304
 iter 43: marginal time gap: 582.0, potential route change: 5180, route change: 300, total travel time:  5086500.0, delay ratio:  0.305
 iter 44: marginal time gap: 527.3, potential route change: 5180, route change: 280, total travel time:  5074400.0, delay ratio:  0.304
 iter 45: marginal time gap: 746.8, potential route change: 5000, route change: 250, total travel time:  5083000.0, delay ratio:  0.305
 iter 46: marginal time gap: 600.5, potential route change: 5170, route change: 220, total travel time:  5074200.0, delay ratio:  0.304
 iter 47: marginal time gap: 508.6, potential route change: 5230, route change: 210, total travel time:  5054400.0, delay ratio:  0.301
 iter 48: marginal time gap: 498.3, potential route change: 5170, route change: 300, total travel time:  5060900.0, delay ratio:  0.302
 iter 49: marginal time gap: 1060.3, potential route change: 4890, route change: 320, total travel time:  5106100.0, delay ratio:  0.308
DSO summary:
 total travel time: initial 6663000.0 -&gt; minimum 5054400.0
 number of potential route changes: initial 5490.0 -&gt; minimum 4890.0
 route marginal travel time gap: initial 5419.0 -&gt; minimum 367.7
 computation time: 42.2 seconds
results:
 average speed:  0.0 m/s
 number of completed trips:      6840 / 6840
 total travel time:              5054400.0 s
 average travel time of trips:   738.9 s
 average delay of trips:         222.3 s
 delay ratio:                    0.301
 total distance traveled:        61180000.0 m
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_31_1.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_31_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_31_2.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_31_2.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_31_3.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_31_3.png" />
</div>
</div>
<p>Now the traffic situation is much better, with 0.31 delay ratio. According to the network animation, traffic was distributed to many routes. Most of traffic congestion observed in DUO/DUE solutions were eliminated.</p>
<p>Below is the summary of the 3 scenarios.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_DUO</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;DUO&#39;</span>
<span class="n">df_DUE</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;DUE&#39;</span>
<span class="n">df_DSO</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;DSO&#39;</span>

<span class="n">df_combined</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_DUO</span><span class="p">,</span> <span class="n">df_DUE</span><span class="p">,</span> <span class="n">df_DSO</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_combined</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="s1">&#39;Name&#39;</span><span class="p">]</span>
<span class="n">df_combined</span> <span class="o">=</span> <span class="n">df_combined</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_combined</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>total_trips</th>
      <th>completed_trips</th>
      <th>total_travel_time</th>
      <th>average_travel_time</th>
      <th>total_delay</th>
      <th>average_delay</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>DUO</td>
      <td>6840</td>
      <td>6840</td>
      <td>6663000.0</td>
      <td>974.122807</td>
      <td>3129000.0</td>
      <td>457.456140</td>
    </tr>
    <tr>
      <th>1</th>
      <td>DUE</td>
      <td>6840</td>
      <td>6840</td>
      <td>5563500.0</td>
      <td>813.377193</td>
      <td>2029500.0</td>
      <td>296.710526</td>
    </tr>
    <tr>
      <th>2</th>
      <td>DSO</td>
      <td>6840</td>
      <td>6840</td>
      <td>5054400.0</td>
      <td>738.947368</td>
      <td>1520400.0</td>
      <td>222.280702</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Below is some vehicle-level analysis. You can see that, on average, travel time in DUE is shorter than that of DUO, and that in DSO is shorter than that of DUE. This indicates overall efficiency of respective route choice principles. However, from the perspective of each individual vehicles, some of them experience longer travel time in DSO than DUE. This can be a potential fairness issue.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">travel_time_per_vehicle_duo</span> <span class="o">=</span> <span class="p">[</span><span class="n">veh</span><span class="o">.</span><span class="n">travel_time</span> <span class="k">for</span> <span class="n">veh</span> <span class="ow">in</span> <span class="n">W_DUO</span><span class="o">.</span><span class="n">VEHICLES</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
<span class="n">travel_time_per_vehicle_due</span> <span class="o">=</span> <span class="p">[</span><span class="n">veh</span><span class="o">.</span><span class="n">travel_time</span> <span class="k">for</span> <span class="n">veh</span> <span class="ow">in</span> <span class="n">W_DUE</span><span class="o">.</span><span class="n">VEHICLES</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
<span class="n">travel_time_per_vehicle_dso</span> <span class="o">=</span> <span class="p">[</span><span class="n">veh</span><span class="o">.</span><span class="n">travel_time</span> <span class="k">for</span> <span class="n">veh</span> <span class="ow">in</span> <span class="n">W_DSO</span><span class="o">.</span><span class="n">VEHICLES</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>

<span class="n">figure</span><span class="p">()</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s2">&quot;travel time of each vehicle&quot;</span><span class="p">)</span>
<span class="n">max_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">travel_time_per_vehicle_duo</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">travel_time_per_vehicle_due</span><span class="p">))</span>
<span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_val</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_val</span><span class="p">],</span> <span class="s2">&quot;k--&quot;</span><span class="p">)</span>
<span class="n">hist2d</span><span class="p">(</span><span class="n">travel_time_per_vehicle_duo</span><span class="p">,</span> <span class="n">travel_time_per_vehicle_due</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_val</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_val</span><span class="p">]],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys&quot;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">average</span><span class="p">(</span><span class="n">travel_time_per_vehicle_duo</span><span class="p">),</span> <span class="n">average</span><span class="p">(</span><span class="n">travel_time_per_vehicle_due</span><span class="p">),</span> <span class="s2">&quot;rx&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">mew</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;average&quot;</span><span class="p">)</span>
<span class="n">colorbar</span><span class="p">()</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;number of vehicles&quot;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;DUO&quot;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;DUE&quot;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">()</span>
<span class="n">show</span><span class="p">()</span>

<span class="n">figure</span><span class="p">()</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s2">&quot;travel time of each vehicle&quot;</span><span class="p">)</span>
<span class="n">max_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">travel_time_per_vehicle_due</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">travel_time_per_vehicle_dso</span><span class="p">))</span>
<span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_val</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_val</span><span class="p">],</span> <span class="s2">&quot;k--&quot;</span><span class="p">)</span>
<span class="n">hist2d</span><span class="p">(</span><span class="n">travel_time_per_vehicle_due</span><span class="p">,</span> <span class="n">travel_time_per_vehicle_dso</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_val</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_val</span><span class="p">]],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys&quot;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">average</span><span class="p">(</span><span class="n">travel_time_per_vehicle_due</span><span class="p">),</span> <span class="n">average</span><span class="p">(</span><span class="n">travel_time_per_vehicle_dso</span><span class="p">),</span> <span class="s2">&quot;rx&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">mew</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;average&quot;</span><span class="p">)</span>
<span class="n">colorbar</span><span class="p">()</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;number of vehicles&quot;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;DUE&quot;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;DSO&quot;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">()</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_35_0.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_35_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_35_1.png" src="../_images/notebooks_demo_notebook_09en_dynamic_traffic_assignment_35_1.png" />
</div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="demo_notebook_08en_chicago.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Huge-scale simulation using Chicago-Sketch dataset</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="demo_notebook_06en_taxi_or_shared_mobility.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Taxi / Shared mobility</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023 Toru Seo
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Dynamic Traffic Assignments: DUO, DUE, DSO</a><ul>
<li><a class="reference internal" href="#Two-route-network-with-parallel-highway-and-arterial">Two route network with parallel highway and arterial</a><ul>
<li><a class="reference internal" href="#DUO">DUO</a></li>
<li><a class="reference internal" href="#DUE">DUE</a></li>
<li><a class="reference internal" href="#DSO">DSO</a></li>
<li><a class="reference internal" href="#Comparison">Comparison</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Large-scale-scenario">Large-scale scenario</a><ul>
<li><a class="reference internal" href="#id1">DUO</a></li>
<li><a class="reference internal" href="#id2">DUE</a></li>
<li><a class="reference internal" href="#id3">DSO</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=5cb08e4e"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=46bd48cc"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>